# This is the site file for pubs.er.usgs.gov

# DirectoryIndex Publication_Warehouse_Home.html
ServerAdmin pubswarehouse@usgs.gov

DocumentRoot /srv/www/vhosts/pubs.er.usgs.gov/html

<Directory /srv/www/vhosts/pubs.er.usgs.gov/html>
    Options FollowSymLinks MultiViews Includes
    AllowOverride None
    Order allow,deny
    Allow from all
    DirectoryIndex Publication_Warehouse_Home.html
</Directory>

Alias /docs/usgs_pubs 		/srv/www/vhosts/pubs.er.usgs.gov/html
Alias /doc/usgs_pubs 		/srv/www/vhosts/pubs.er.usgs.gov/html
Alias /images/cida_logo.gif 	/srv/www/vhosts/pubs.er.usgs.gov/html/images/cida_logo_pubs_yellow.gif

ProxyPreserveHost On
RewriteEngine on
RewriteRule ^/pubs/(.*)$ /usgspubs/$1   [R=302]

# This handles /usgspubs/news
RewriteRule ^/usgspubs/news/(.+)$    /news/$1 [R=302,L]

RewriteCond %{REQUEST_URI} !^/usgspubs/publication/.*$
RewriteRule ^/usgspubs/.+/(.+)$ /publication/$1 [R=302,L]

# Workaround until Dave removes the reference to /usgspubs
RewriteRule ^/usgspubs/publication/(.*)$    /publication/$1 [R=302,L]

# http://pubs.er.usgs.gov/usgspubs/index.jsp?view=adv --> pubs.er.usgs.gov
RewriteCond %{QUERY_STRING} ^view=adv
RewriteRule ^/usgspubs/index.jsp$       /? [R=302,L]

# http://pubs.er.usgs.gov/apex/f?p=127:4 --> pubs.er.usgs.gov
RewriteCond %{QUERY_STRING} ^p=127:4
RewriteRule ^/apex/f$       /?   [R=302,L]

# http://pubs.er.usgs.gov/usgspubs/contact.jsp  -->  /#faq
RewriteRule ^/usgspubs/contact.jsp$  /#faq   [R=302,L]

# http://pubs.er.usgs.gov/usgspubs/recentpubs.jsp  --> pubs.er.usgs.gov
RewriteRule ^/usgspubs/recentpubs.jsp$  /? [R=302,L]

##
## /mypubs (infra-1094) --sstephan
##

RewriteRule ^/mypubs$ /mypubs/ [R=301,L]
RewriteCond %{HTTPS} off
RewriteRule ^/mypubs/(.*)$ https://pubs.er.usgs.gov/mypubs/$1 [R=301,L]
RewriteRule ^/mypubs/(.*)$ balancer://eros-javaprodp-ssl/mypubs/$1 [P,L]

<Location /mypubs>
    ProxyPassReverse balancer://eros-javaprodp/mypubs
    ProxyPassReverse balancer://eros-javaprodp-ssl/mypubs
    ProxyPassReverseCookieDomain .usgs.gov pubs.er.usgs.gov
    Header edit Location ^https://[^:]+:8443/mypubs/ https://pubs.er.usgs.gov/mypubs/ env=!HTTPS
    Header edit Location ^http://[^:]+:8080/mypubs/ http://pubs.er.usgs.gov/mypubs/ env=HTTPS
</Location>

##
## /service (infra-1094) --sstephan
##

RewriteRule ^/service$ /service/ [R=301,L]
RewriteCond %{HTTPS} off
RewriteRule ^/service/(.*)$ balancer://javapen/pubs_web_service/service/$1 [P,L]
RewriteRule ^/service/(.*)$ balancer://javapen-ssl/pubs_web_service/service/$1 [P,L]

<Location /service>
    ProxyPassReverse balancer://javapen/pubs_web_service/service
    ProxyPassReverse balancer://javapen-ssl/pubs_web_service/service
    ProxyPassReverseCookieDomain .usgs.gov pubs.er.usgs.gov
    ProxyPassReverseCookiePath /pubs_web_service/service /service
    Header edit Location ^https://[^:]+:8443/pubs_web_service/service/ https://pubs.er.usgs.gov/service/ env=!HTTPS
    Header edit Location ^http://[^:]+:8080/pubs_web_service/service/ http://pubs.er.usgs.gov/service/ env=HTTPS
</Location>

RewriteCond %{REQUEST_URI} !^/thumbnails/
RewriteCond %{REQUEST_URI} !^/djvu/
RewriteCond %{REQUEST_URI} !^/images/cida_logo.gif
RewriteCond %{REQUEST_URI} !^/robots.txt
RewriteCond %{REQUEST_URI} !^/sitemapindex.xml
RewriteCond %{REQUEST_URI} !^/sitemap/
RewriteCond %{REQUEST_URI} !^/google2acd1c1515b1b6cb.html
RewriteRule ^/(.*)$ balancer://javapen/pubs2_ui/$1 [P,L]
ProxyPassReverseCookiePath  /pubs2_ui /

# vim: syntax=apache tw=1000 expandtab tabstop=4 softtabstop=4 showmatch nocompatible shiftwidth=4 ai
